<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Most Used Words in the Bible</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: auto;
        }
        #word-cloud {
            text-align: center;
            max-width: 80%;
            flex-wrap: wrap;
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        .word {
            cursor: pointer;
            display: inline-block;
            transition: transform 0.2s;
            padding: 5px;
        }
        .word:hover {
            transform: scale(1.1);
            color: #007BFF;
        }
        #popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 20px;
            border: 2px solid #333;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            z-index: 1000;
            max-width: 400px;
            text-align: left;
        }
        #popup-close {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
            font-size: 20px;
            color: #333;
        }
        #overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }
    </style>
</head>
<body>
    <div id="overlay"></div>
    <div id="word-cloud"></div>
    <div id="popup">
        <span id="popup-close">Ã—</span>
        <h2 id="popup-title"></h2>
        <p id="popup-content"></p>
    </div>

    <script>
        // Function to fetch all books from the API
        async function fetchBooks() {
            const response = await fetch('https://bible-go-api.rkeplin.com/v1/books');
            return await response.json();
        }

        // Function to fetch all chapters and verses for a book
        async function fetchBookText(bookId) {
            let allText = "";
            const chaptersResponse = await fetch(`https://bible-go-api.rkeplin.com/v1/books/${bookId}/chapters?translation=KJV`);
            const chapters = await chaptersResponse.json();

            for (const chapter of chapters) {
                const versesResponse = await fetch(`https://bible-go-api.rkeplin.com/v1/books/${bookId}/chapters/${chapter.id}?translation=KJV`);
                const verses = await versesResponse.json();
                verses.forEach(verse => {
                    allText += verse.text + " ";
                });
            }
            return allText;
        }

        // Function to fetch and process the full Bible text
        async function fetchBibleText() {
            const books = await fetchBooks();
            let fullText = "";

            // Fetch text for each book (limited to 2 books for demo; remove slice for full Bible)
            for (const book of books.slice(0, 2)) {
                const bookText = await fetchBookText(book.id);
                fullText += bookText;
            }

            return processText(fullText);
        }

        // Function to process text and count word frequencies
        function processText(text) {
            const words = text.toLowerCase()
                .replace(/[^\w\s]/g, '') // Remove punctuation
                .split(/\s+/)
                .filter(word => word.length > 2); // Filter short words
            const wordCount = {};

            words.forEach(word => {
                wordCount[word] = (wordCount[word] || 0) + 1;
            });

            // Convert to array, sort by frequency, and take top 10
            const wordArray = Object.entries(wordCount)
                .map(([word, count]) => ({ word, count }))
                .sort((a, b) => b.count - a.count)
                .slice(0, 10);

            return wordArray;
        }

        // Function to fetch precomputed word data (alternative approach)
        async function fetchWordData() {
            // Uncomment to use precomputed JSON instead of live API
            // const response = await fetch('word-frequencies.json');
            // return await response.json();

            // Use live API data
            return await fetchBibleText();
        }

        // Function to display words
        async function displayWords() {
            const wordData = await fetchWordData();
            const wordCloud = document.getElementById('word-cloud');
            const maxCount = Math.max(...wordData.map(w => w.count));
            const totalWords = wordData.reduce((sum, item) => sum + item.count, 0); // Total for demo; replace with full count (e.g., 788258 for KJV)

            wordData.forEach(item => {
                const span = document.createElement('span');
                span.className = 'word';
                span.textContent = item.word;
                const fontSize = (item.count / maxCount) * 60 + 10; // Scale from 10px to 70px
                span.style.fontSize = `${fontSize}px`;
                span.addEventListener('click', () => showPopup(item, totalWords));
                wordCloud.appendChild(span);
            });
        }

        // Function to show popup with stats
  function showPopup(item, totalWords) {
    const popup = document.getElementById('popup');
    const overlay = document.getElementById('overlay');
    const title = document.getElementById('popup-title');
    const content = document.getElementById('popup-content');

    title.textContent = item.word;
    content.innerHTML = `
        <strong>Occurrences:</strong> ${item.count} times<br>
        <strong>Percentage of total words:</strong> ${(item.count / totalWords * 100).toFixed(2)}%<br>
        <strong>Rank:</strong> ${wordData.indexOf(item) + 1}
    `;

    popup.style.display = 'block';
    overlay.style.display = 'block';
}

        // Close popup functionality
        document.getElementById('popup-close').addEventListener('click', () => {
            document.getElementById('popup').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
        });
        document.getElementById('overlay').addEventListener('click', () => {
            document.getElementById('popup').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
        });

        // Load words on page load
        displayWords();
    </script>
</body>
</html>
